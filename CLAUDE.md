# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

x-agent is a collection of Claude Code skills (prompt-based, not traditional code) for generating social media posts (X/Twitter + Threads) that match a specific user's voice. It uses a Twitter MCP server for API access.

## Architecture

This is a **skills-only repo** — no build system, no tests, no runtime code. The "code" is markdown-based skill definitions that Claude Code executes directly.

```
skills/          → Claude Code skill definitions (markdown with YAML frontmatter)
examples/        → Example outputs showing expected formats
~/.x-agent/      → Runtime data directory (outside repo, on user's machine)
  ├── config.json    → Twitter username, rest_id, RSS feeds
  ├── profile.md     → User persona & style rules (generated by /init)
  ├── tweets/        → Raw tweet archives (generated by /init)
  ├── ideas/         → Recorded ideas by week (generated by /idea)
  ├── research/      → Fetched research data (generated by /twitter)
  └── posts/         → Generated posts (generated by /twitter)
```

## Skills

| Skill | File | Purpose |
|-------|------|---------|
| `/init "username"` | `skills/init.md` | Fetch Twitter user info + tweets → build persona profile → save to `~/.x-agent/profile.md` and `~/.x-agent/tweets/` |
| `/idea "text"` | `skills/idea.md` | Append a timestamped idea to `~/.x-agent/ideas/YYYY-WXX.md` |
| `/twitter "topic"` | `skills/twitter.md` | Research topic → match user style from profile → generate X + Threads posts → save to `~/.x-agent/posts/` |

## Key Design Decisions

- **All data lives in `~/.x-agent/`**, not in the repo. The repo only contains skill definitions and examples.
- **Profile-first workflow**: `/init` must run before `/twitter` to establish the user's voice. The profile at `~/.x-agent/profile.md` contains style rules that `/twitter` references.
- **Twitter MCP dependency**: Skills assume a Twitter MCP server is configured. The `Get User By Username` and `Search Twitter` (with `from:username` query) endpoints are the primary data sources. Note: `Get User Tweets` may fail due to large rest_id precision issues — use `Search Twitter` with `from:username` as a workaround.
- **Bilingual support**: The target user (@thuwyh) writes English content with occasional Chinese replies. Generated content should be English-only unless specified.

## Skill File Format

Skills use YAML frontmatter + markdown body:

```yaml
---
name: skill-name
description: Short description. Usage: /skill-name "args"
user-invocable: true
---
```

`$ARGUMENTS` in the body is replaced with user-provided arguments at invocation time.

## Working with Twitter MCP

- User profile lookup: `Get_User_By_Username` → returns `rest_id`, bio, stats
- User tweets: **Do NOT use `Get_User_Tweets`** (rest_id loses precision as a number). Use `Search_Twitter` with query `from:username`, type `Latest` instead.
- Trending topics: `Get_Trends_By_Location`
- Topic research: `Search_Twitter` with topic query

### Handling large MCP responses

Twitter search results are often too large for the context window and get saved to a temporary file. When this happens:
- Use a **subagent** (Task tool, `general-purpose` type) to read and parse the file
- The file contains a JSON array: `[{ "type": "text", "text": "<inner JSON string>" }]`
- Parse the inner JSON string to access tweet data

### Search Twitter response structure

```
Parsed inner JSON:
├── cursor.bottom          → pagination cursor for next page
├── result.timeline.instructions[0].entries[]
│   ├── tweet entries (entryId: "tweet-XXX")
│   │   └── content.itemContent.tweet_results.result.legacy
│   │       ├── full_text, created_at
│   │       ├── favorite_count, retweet_count, reply_count, quote_count
│   │       ├── in_reply_to_screen_name (if reply)
│   │       └── extended_entities.media[].type (photo/video)
│   └── cursor entries (entryId: "cursor-bottom-0")
│       └── content.value   → same as cursor.bottom
```

See `skills/init.md` Step 2 for the complete parsing reference.
